name: Secrets Demo

on:
  workflow_dispatch: {}   # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ìœ¼ë¡œ ëŒë¦½ë‹ˆë‹¤.

jobs:
  show_secrets_usage:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1) ì‹œí¬ë¦¿ ì¡´ìž¬ í™•ì¸ (ê°’ì€ ë§ˆìŠ¤í‚¹ë˜ì–´ ë…¸ì¶œë˜ì§€ ì•ŠìŒ)
      - name: Preflight: ensure secret exists
        run: |
          if [ -z "${{ secrets.MY_SECRET }}" ]; then
            echo "âŒ MY_SECRET is missing. Add it in Settings > Secrets and variables > Actions."
            exit 1
          else
            echo "âœ… MY_SECRET exists (value is masked in logs)."
          fi

      # 2) ì‹œí¬ë¦¿ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬í•´ "ê¸¸ì´"ë§Œ ì¶œë ¥ (ê°’ì€ ì—¬ì „ížˆ ë§ˆìŠ¤í‚¹)
      - name: Use secret safely (length only)
        env:
          MY_SECRET: ${{ secrets.MY_SECRET }}
        run: |
          echo "ðŸ”’ Masked echo: ${MY_SECRET}"                 # ë¡œê·¸ì— ***** ë¡œ ë³´ìž„
          echo "ðŸ”Ž Secret length: ${#MY_SECRET}"              # ê¸¸ì´ëŠ” ìˆ«ìžë¡œ ì¶œë ¥ë¨

      # 3) ì‹œí¬ë¦¿ì´ ì—†ìœ¼ë©´ ì‹¤íŒ¨, ìžˆìœ¼ë©´ ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
      - name: Do something that requires the secret
        env:
          MY_SECRET: ${{ secrets.MY_SECRET }}
        run: |
          # ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ê°„ë‹¨í•œ ê²€ì¦ë§Œ í•©ë‹ˆë‹¤.
          test -n "$MY_SECRET"
          echo "ðŸš€ Action can proceed with the provided secret!"

      # 4) (ì˜µì…˜) ì‹œí¬ë¦¿ ê¸°ë°˜ìœ¼ë¡œ íŒŒì¼ ìƒì„± (ë‚´ìš©ì€ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ)
      - name: Create artifact that proves it ran
        env:
          MY_SECRET: ${{ secrets.MY_SECRET }}
        run: |
          echo "This job ran with a secret present at $(date -u +"%Y-%m-%dT%H:%M:%SZ")." > run-proof.txt
          echo "Secret length was ${#MY_SECRET} (value masked in logs)." >> run-proof.txt

      - name: Upload proof artifact
        uses: actions/upload-artifact@v4
        with:
          name: run-proof
          path: run-proof.txt



